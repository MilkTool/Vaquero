
; simple object

(def bareobj (object))
(def simp (object 'a 1 'b 2))

(test 'obj-type (= simp.type 'object))
(test 'message-send (and (= simp.a 1) (= simp.b 2)))
(test 'object-responds? (and (simp.responds? 'a) (not (simp.responds? 'c))))
(test 'object-messages (= (simp.messages.sort <) '(a b)))

(test 'obj-true (= true simp.to-bool))
(test 'obj-false (= false bareobj.to-bool))

; autoexec

(def otto
    (let (c (box 3))
        (object
            'var (lambda () c.val)
            'thunky (lambda () (c.set! (+ c.val 1)))
            'thunkle (lambda () (* otto.var 10))
            auto: '(var thunky thunkle))))

(test 'auto-basic (= otto.var 3))
(test 'auto-set! (seq otto.thunky (= otto.var 4)))
(test 'auto-info (= otto.thunkle (* 10 otto.var)))


; resend

(def resender
    (object
        'd 4
        resend: (list
            (list simp 'a 'b)
            (list otto 'c 'thunkle))))

(test 'resend-basic (= resender.d 4))
(test 'resend-simple (= resender.a 1))
(test 'resend-auto (= resender.thunkle (* 10 otto.var)))


; default

(def defaulter
    (object
        'e 5
        default: (lambda (msg) (send resender msg))))

(test 'default-basic (= defaulter.e 5))
(test 'default-parent (= defaulter.d 4))
(test 'default-ancestor (= defaulter.a 1))
(test 'default-resend (= defaulter.thunkle (* 10 otto.var)))


