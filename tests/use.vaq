
; use

(sys.test 'use-proc-file
    (let ()
        (use foreigner "modules/proc.vaq")
        (= (foreigner.go 1 2) '(foreigner 1 2))))

(sys.test 'use-macro-file
    (let ()
        (use m "modules/macro.vaq")
        (and
            (= (m.quote-xyz 1 2 3) '(1 2 3))
            (= (send (m.calc-xyz 1 2 3) 'code) '(proc (v) (* v 17)))
            (= ((m.calc-xyz 1 2 3) 4 ) 68))))

(sys.test 'use-proc-https
    (let () 
        (use foreigner "https://raw.githubusercontent.com/TurtleKitty/Vaquero/master/tests/modules/proc.vaq")
        (= (foreigner.go 1 2) '(foreigner 1 2))))

(sys.test 'use-macro-https
    ((proc ()
        (use m "https://raw.githubusercontent.com/TurtleKitty/Vaquero/master/tests/modules/macro.vaq")
        (and
            (= (m.quote-xyz 1 2 3) '(1 2 3))
            (= (send (m.calc-xyz 1 2 3) 'code) '(proc (v) (* v 17)))
            (= ((m.calc-xyz 1 2 3) 4 ) 68)))))

(sys.test 'use-mutually-recursive
    (let ()
        (use m1 "modules/x.vaq")
        (use m2 "modules/y.vaq")
        (and
            (= 'x (m1.do-it 4))
            (= 'y (m2.do-it 5)))))

(sys.test 'import-proc false)
(sys.test 'import-macro false)

(rem: commenting out until new module system is online

(sys.test 'use-symbol
    (let ()
        (and
            (= '(test "0.2.0") (use m1 vaquero/test/vaquero-lib/0))
            (= '(test "0.1.2") (use m2 vaquero/test/vaquero-lib/0.1))
            (= '(test "0.1.0") (use m3 vaquero/test/vaquero-lib/0.1.0))
            (= '(test "1.6.4") (use m4 vaquero/test/vaquero-lib/1))
            (= '(test "1.2.4") (use m5 vaquero/test/vaquero-lib/1.2.4))
            (= '(test "1.5.9") (use m6 vaquero/test/vaquero-lib/1.5))
            (= '(test "1.5.7") (use m7 vaquero/test/vaquero-lib/1.5.7))
            (= '(test "0.2.0") (use m8 github/TurtleKitty/vaquero-lib/test/vaquero-lib/0))
            (= '(test "1.6.4") (use m9 github/TurtleKitty/vaquero-lib/test/vaquero-lib/1)))))
)

